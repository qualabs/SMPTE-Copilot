version: '3.8'

services:
  # Service for ingesting documents
  ingest:
    build: .
    image: rag-poc-v1
    container_name: rag-ingest
    volumes:
      # Mount database directory to persist data
      - ./chroma_db:/app/chroma_db
      # Mount data directory for PDFs
      - ./data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
      - CHROMA_DB_PATH=/app/chroma_db
      - COLLECTION_NAME=rag_collection
    # Default command: show usage
    command: python ingest.py --help
    # Override when running: docker-compose run ingest python ingest.py /app/data/file.pdf

  # Service for querying documents
  query:
    build: .
    image: rag-poc-v1
    container_name: rag-query
    volumes:
      # Mount database directory (read-only for queries)
      - ./chroma_db:/app/chroma_db
    environment:
      - PYTHONUNBUFFERED=1
      - CHROMA_DB_PATH=/app/chroma_db
      - COLLECTION_NAME=rag_collection
    # Default command: show usage
    command: python query.py --help
    # Override when running: docker-compose run query python query.py "your question"

