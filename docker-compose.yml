version: '3.8'

volumes:
  vector_db:

services:
  # Service for ingesting documents
  ingest:
    build: .
    image: rag-poc-v1
    container_name: rag-ingest
    volumes:
      - vector_db:/app/vector_db
      - ./data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
      - VECTOR_DB_PATH=/app/vector_db
      - COLLECTION_NAME=rag_collection
    # Default command: show usage
    command: python ingest.py --help
    # Override when running: docker-compose run ingest python ingest.py /app/data/file.pdf

  # Service for querying documents
  query:
    build: .
    image: rag-poc-v1
    container_name: rag-query
    volumes:
      - vector_db:/app/vector_db
    environment:
      - PYTHONUNBUFFERED=1
      - VECTOR_DB_PATH=/app/vector_db
      - COLLECTION_NAME=rag_collection
    # Default command: show usage
    command: python query.py --help
    # Override when running: docker-compose run query python query.py "your question"

